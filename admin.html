<!DOCTYPE html>
<html>
<head>
  <title>AppointEase â€” Admin Panel</title>

  <style>
    body{
      margin:0;
      font-family:'Segoe UI', sans-serif;
      background:#f3f4f6;
      transition:.3s;
    }

    body.dark-mode{
      background:#0f172a;
      color:white;
    }

    .layout{
      display:flex;
      min-height:100vh;
    }

    .sidebar{
      width:240px;
      background:#111827;
      color:white;
      padding:20px;
    }

    .sidebar h2{
      margin-top:0;
      color:#a5b4fc;
    }

    .sidebar button{
      width:100%;
      padding:10px;
      margin:8px 0;
      background:#1f2937;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
      text-align:left;
    }

    .sidebar button:hover{
      background:#374151;
    }

    .content{
      flex:1;
      padding:25px;
    }

    .top-bar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-bottom:20px;
    }

    input,select{
      padding:8px;
      border-radius:8px;
      border:1px solid #ccc;
    }

    body.dark-mode input,
    body.dark-mode select{
      background:#1e293b;
      color:white;
      border:1px solid #334155;
    }

    .card{
      background:white;
      padding:15px;
      border-radius:12px;
      margin-bottom:15px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }

    body.dark-mode .card{
      background:#1e293b;
    }

    .status{
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
    }

    .Pending{background:#facc15;}
    .Approved{background:#22c55e;color:white;}
    .Rejected{background:#ef4444;color:white;}
    .Cancelled{background:#64748b;color:white;}

    .timeline{
      font-size:13px;
      margin-top:6px;
    }

    .btn{
      margin-top:10px;
      padding:6px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }

    .approve{background:#22c55e;color:white;}
    .reject{background:#ef4444;color:white;}

    .dark-toggle{
      cursor:pointer;
      font-size:14px;
    }
  </style>
</head>

<body onload="initAdmin()">

<div class="layout">

<aside class="sidebar">
  <h2>Admin Panel</h2>

  <button onclick="location.reload()">ðŸ“Š Dashboard</button>
  <button class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ™ Toggle</button>
  <button onclick="logout()">ðŸšª Logout</button>
</aside>

<main class="content">

  <div class="top-bar">
    <h2>All Appointments</h2>
  </div>

  <div class="controls">
    <input type="text" id="searchInput" placeholder="Search by ID or Email" onkeyup="loadAppointments()">
    <select id="filterCategory" onchange="loadAppointments()">
      <option value="">All Categories</option>
      <option value="Healthcare">Healthcare</option>
      <option value="Salon">Salon</option>
    </select>
  </div>

  <div id="appointments"></div>

</main>
</div>

<script src="system.js"></script>

<script>
function initAdmin(){
  loadDarkMode();
  loadAppointments();
}

function loadAppointments(){

  const container = document.getElementById("appointments");
  container.innerHTML = "";

  const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");

  const searchInput = document.getElementById("searchInput").value || "";
  const search = searchInput.toLowerCase();

  const filter = document.getElementById("filterCategory").value;

  if(!bookings.length){
    container.innerHTML = "<p>No appointments found.</p>";
    return;
  }

  const filtered = bookings.filter(b => {

    const id = (b.appointmentID || "").toLowerCase();
    const email = (b.userEmail || "").toLowerCase();
    const category = b.category || "";

    const matchSearch = id.includes(search) || email.includes(search);
    const matchFilter = filter ? category === filter : true;

    return matchSearch && matchFilter;
  });

  if(!filtered.length){
    container.innerHTML = "<p>No appointments found.</p>";
    return;
  }

  filtered.forEach(b => {

    container.innerHTML += `
      <div class="card">
        <strong>ID:</strong> ${b.appointmentID || "-"}<br>
        <strong>User:</strong> ${b.userEmail || "-"}<br>
        <strong>${b.category || "-"}</strong> - ${b.service || "-"}<br>
        ${b.place || "-"} | ${b.date || "-"} | ${b.time || "-"}<br>
        <span class="status ${b.status}">${b.status}</span>

        <div class="timeline">
          Timeline: ${(b.timeline || []).join(" â†’ ")}
        </div>

        ${
          b.status === "Pending"
          ? `
            <button class="btn approve" onclick="updateStatus('${b.appointmentID}','Approved')">Approve</button>
            <button class="btn reject" onclick="updateStatus('${b.appointmentID}','Rejected')">Reject</button>
          `
          : `<br><small>Decision Locked</small>`
        }
      </div>
    `;
  });
}

function updateStatus(id,newStatus){

  let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");

  bookings = bookings.map(b => {

    if(b.appointmentID === id && b.status === "Pending"){
      b.status = newStatus;

      if(!b.timeline){
        b.timeline = ["Requested"];
      }

      b.timeline.push(newStatus);

addNotification(b.userEmail, "Your appointment " + id + " was " + newStatus + ".");   
 }

    return b;
  });

  localStorage.setItem("bookings", JSON.stringify(bookings));
  loadAppointments();
}

function logout(){
  localStorage.removeItem("activeSession");
  localStorage.removeItem("currentUserEmail");
  window.location.href="auth/login.html";
}
</script>
</body>
</html>