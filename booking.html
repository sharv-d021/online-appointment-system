<!DOCTYPE html>
<html>
<head>
  <title>AppointEase ‚Äî Premium Booking</title>

  <style>
    body{
      margin:0;
      font-family:'Segoe UI', sans-serif;
      background:linear-gradient(135deg,#eef2ff,#f8fafc);
      min-height:100vh;
      transition:.3s;
    }

    body.dark-mode{
      background:linear-gradient(135deg,#0f172a,#1e293b);
      color:white;
    }

    body.dark-mode .form-card{
      background:rgba(30,41,59,.9);
    }

    body.dark-mode .suggest-box{
      background:#1e293b;
    }

    body.dark-mode input,
    body.dark-mode select{
      background:#0f172a;
      color:white;
      border:1px solid #334155;
    }

    .dark-toggle{
      position:fixed;
      top:15px;
      right:20px;
      cursor:pointer;
      font-size:18px;
    }

    .container{
      max-width:880px;
      margin:25px auto;
      padding:20px;
    }

    h2{text-align:center;margin-bottom:8px;color:inherit;}
    .subtitle{text-align:center;margin-bottom:20px;}

    .steps{
      display:flex;
      justify-content:center;
      gap:20px;
      margin-bottom:20px;
      font-size:14px;
    }

    .step.active{color:#4f46e5;font-weight:bold;}

    .categories{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:14px;
      margin-bottom:20px;
    }

    .cat-card{
      background:rgba(255,255,255,.75);
      backdrop-filter:blur(10px);
      padding:16px;
      border-radius:14px;
      text-align:center;
      cursor:pointer;
      font-weight:bold;
      transition:.3s;
      box-shadow:0 6px 14px rgba(0,0,0,.08);
    }

    .cat-card:hover{transform:translateY(-4px);}
    .selected{background:#4f46e5;color:white;}

    .form-card{
      background:rgba(255,255,255,.85);
      backdrop-filter:blur(12px);
      padding:24px;
      border-radius:16px;
      box-shadow:0 8px 20px rgba(0,0,0,.12);
      animation:fadeUp .5s ease;
    }

    @keyframes fadeUp{
      from{opacity:0;transform:translateY(20px);}
      to{opacity:1;transform:translateY(0);}
    }

    label{display:block;margin-top:12px;font-weight:600;}
    select,input{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #ddd;
      outline:none;
      transition:.2s;
    }

    input:focus,select:focus{
      border-color:#4f46e5;
      box-shadow:0 0 0 3px rgba(79,70,229,.2);
    }

    .row{display:flex;gap:15px;}

    .suggest-box{
      display:none;
      margin-top:6px;
      background:white;
      border-radius:10px;
      box-shadow:0 6px 14px rgba(0,0,0,.12);
      overflow:hidden;
    }

    .suggest-item{
      padding:10px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .suggest-item:hover{background:#eef2ff;}

    button{
      margin-top:18px;
      padding:11px 18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:bold;
      transition:.25s;
    }

    .primary{background:#4f46e5;color:white;}
    .primary:hover{transform:translateY(-2px);}
    .back{background:#111827;color:white;margin-left:8px;}

    .popup{
      position:fixed;
      top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,.45);
      display:none;
      justify-content:center;
      align-items:center;
    }

    .popup-box{
      background:white;
      padding:25px;
      border-radius:14px;
      text-align:center;
      animation:pop .35s ease;
    }

    @keyframes pop{
      from{transform:scale(.7);opacity:0;}
      to{transform:scale(1);opacity:1;}
    }
  </style>
</head>

<body onload="loadDarkMode()">

<div class="dark-toggle" onclick="toggleDarkMode()">üåô</div>

<div class="container">

<h2>‚ú® Book Your Appointment</h2>
<p class="subtitle">Fast ‚Ä¢ Easy ‚Ä¢ Professional</p>

<div class="steps">
  <div class="step active">1. Category</div>
  <div class="step">2. Service</div>
  <div class="step">3. Confirm</div>
</div>

<div class="categories">
  <div class="cat-card" onclick="chooseCat('Healthcare',this)">üè• Healthcare</div>
  <div class="cat-card" onclick="chooseCat('Salon',this)">üíá Salon</div>
</div>

<div class="form-card">

<label>Service</label>
<select id="service">
  <option value="">Select category first...</option>
</select>

<label>City</label>
<input id="city" placeholder="Enter city">

<label>Place</label>
<input id="place" placeholder="Search place..." onkeyup="filterPlaces()">

<div id="suggestions" class="suggest-box"></div>

<div class="row">
  <div>
    <label>Date</label>
    <input type="date" id="date">
  </div>
  <div>
    <label>Time</label>
    <input type="time" id="time">
  </div>
</div>

<label>Reason</label>
<input id="reason">

<button class="primary" onclick="bookAppointment()">Confirm Booking</button>
<button class="back" onclick="goBack()">Back</button>

</div>
</div>

<div class="popup" id="successPopup">
  <div class="popup-box">
    <h3>üéâ Booking Submitted!</h3>
    <p id="successText"></p>
  </div>
</div>

<script src="system.js"></script>

<script>
let selectedCategory="";

const services={
  "Healthcare":["Dentist","General Doctor","Physiotherapy","Lab Test"],
  "Salon":["Haircut","Facial","Spa","Makeup"]
};

const places={
  "Healthcare":[
    {icon:"üè•",name:"Gentle Dental Care (BDS)"},
    {icon:"ü©∫",name:"Arogya Ayurvedic Clinic(BAMS)"},
    {icon:"üè®",name:"Balance Homeopathic Care(BHMS)"},
    {icon:"ü©ª",name:"Active Motion Physio (BPT)"}
  ],
  "Salon":[
    {icon:"üíá",name:"Lakme Salon"},
    {icon:"‚úÇÔ∏è",name:"Jawed Habib"},
    {icon:"üíÜ",name:"Naturals Salon"},
    {icon:"‚ú®",name:"BBlunt Studio"}
  ]
};

function chooseCat(cat,el){
  selectedCategory=cat;
  document.querySelectorAll(".cat-card")
   .forEach(c=>c.classList.remove("selected"));
  el.classList.add("selected");

  const s=document.getElementById("service");
  s.innerHTML=`<option>Select ${cat} service...</option>`;
  services[cat].forEach(x=>s.innerHTML+=`<option>${x}</option>`);
}

function showSuggestions(text){
  const box=document.getElementById("suggestions");
  box.innerHTML="";
  const list=places[selectedCategory]||[];

  const filtered=list.filter(p =>
    p.name.toLowerCase().includes(text.toLowerCase())
  );

  if(!filtered.length){ box.style.display="none"; return; }

  box.style.display="block";
  filtered.forEach(p=>{
    box.innerHTML += `
      <div class="suggest-item" onclick="selectPlace('${p.name}')">
        ${p.icon} ${p.name}
      </div>
    `;
  });
}

function filterPlaces(){
  showSuggestions(document.getElementById("place").value);
}

function selectPlace(name){
  document.getElementById("place").value=name;
  document.getElementById("suggestions").style.display="none";
}

function isFutureDateTime(date, time){
  const now = new Date();

  const selectedDateTime = new Date(date + "T" + time);

  return selectedDateTime > now;
}

function bookAppointment(){

  const service=document.getElementById("service").value;
  const city=document.getElementById("city").value;
  const place=document.getElementById("place").value;
  const date=document.getElementById("date").value;
  const time=document.getElementById("time").value;
  const reason=document.getElementById("reason").value;

  /* PAST DATE / TIME CHECK */
  if(!isFutureDateTime(date, time)){
  alert("‚ö† Enter a valid Date.");
  return;
  }

  /* SLOT CONFLICT */
  if(isSlotBooked(selectedCategory, place, date, time)){
    alert("‚ö† This slot is already booked. Please choose another.");
    return;
  }

const currentEmail = sessionStorage.getItem("currentUserEmail");

if(!currentEmail){
  window.location.href = "auth/login.html";
  return;
}

const users = JSON.parse(localStorage.getItem("users") || "[]");
const user = users.find(u => u.email === currentEmail);  
let bookings=JSON.parse(localStorage.getItem("bookings")||"[]");

  const appointmentID = generateAppointmentID();

  bookings.push({
    appointmentID,
    userName:user.name,
    userEmail:user.email,
    category:selectedCategory,
    service,city,place,date,time,reason,
    status:"Pending",
    timeline:["Requested"]
  });

  localStorage.setItem("bookings",JSON.stringify(bookings));

  document.getElementById("successText").innerText =
    "Your Appointment ID is: " + appointmentID;

  document.getElementById("successPopup").style.display="flex";

  setTimeout(()=>{
    window.location.href="user-dashboard.html";
  },1800);
}

function goBack(){
  window.location.href="user-dashboard.html";
}
</script>

</body>
</html>