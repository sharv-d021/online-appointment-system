<!DOCTYPE html>
<html>
<head>
  <title>AppointEase ‚Äî User Dashboard</title>

  <style>
    body{
      margin:0;
      font-family:'Segoe UI', sans-serif;
      background:#f3f4f6;
      transition:.3s;
    }

    body.dark-mode{
      background:#0f172a;
      color:white;
    }

    .layout{
      display:flex;
      min-height:100vh;
    }

    .sidebar{
      width:240px;
      background:#111827;
      color:white;
      padding:20px;
    }

    .sidebar h2{
      margin-top:0;
      color:#a5b4fc;
    }

    .sidebar button{
      width:100%;
      padding:10px;
      margin:8px 0;
      background:#1f2937;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
      text-align:left;
    }

    .sidebar button:hover{
      background:#374151;
    }

    .content{
      flex:1;
      padding:25px;
    }

    .top-bar{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .bell{
      position:relative;
      cursor:pointer;
      font-size:20px;
    }

    .badge{
      position:absolute;
      top:-5px;
      right:-8px;
      background:red;
      color:white;
      border-radius:50%;
      font-size:12px;
      padding:2px 6px;
    }

    .card{
      background:white;
      padding:15px;
      border-radius:12px;
      margin-bottom:15px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }

    body.dark-mode .card{
      background:#1e293b;
    }

    .status{
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
    }

    .Pending{background:#facc15;}
    .Approved{background:#22c55e;color:white;}
    .Rejected{background:#ef4444;color:white;}

    .timeline{
      margin-top:8px;
      font-size:13px;
      opacity:.9;
    }

    .cancel-btn{
      margin-top:10px;
      background:#ef4444;
      color:white;
      border:none;
      padding:6px 12px;
      border-radius:6px;
      cursor:pointer;
    }

    .dark-toggle{
      cursor:pointer;
      font-size:14px;
    }

    .notification-box{
      position:absolute;
      right:0;
      top:35px;
      width:260px;
      background:white;
      border-radius:8px;
      box-shadow:0 6px 16px rgba(0,0,0,.2);
      display:none;
      z-index:10;
    }

    body.dark-mode .notification-box{
      background:#1e293b;
    }

    .notification-item{
      padding:10px;
      border-bottom:1px solid #eee;
      font-size:13px;
    }

    body.dark-mode .notification-item{
      border-color:#334155;
    }
  </style>
</head>

<body onload="initDashboard()">

<div class="layout">

<aside class="sidebar">
  <h2>AppointEase</h2>

  <button onclick="location.reload()">üè† Dashboard</button>
  <button onclick="window.location.href='booking.html'">‚ûï Book</button>
  <button onclick="window.location.href='appointment.html'">üìÖ My Appointments</button>
  <button onclick="window.location.href='profile.html'">üë§ Profile</button>
  <button class="dark-toggle" onclick="toggleDarkMode()">üåô Toggle</button>
  <button onclick="logout()">üö™ Logout</button>
</aside>

<main class="content">

  <div class="top-bar">
    <h2 id="welcomeText"></h2>

    <div style="position:relative;">
      
      </span>

      <div class="notification-box" id="notifyBox"></div>
    </div>
  </div>

  <div id="appointments"></div>

</main>
</div>

<script src="system.js"></script>

<script src="system.js"></script>

<script>
function initDashboard(){

  loadDarkMode();

  const currentEmail = sessionStorage.getItem("currentUserEmail");

  if(!currentEmail){
    window.location.href="auth/login.html";
    return;
  }

  const users = JSON.parse(localStorage.getItem("users") || "[]");
  const user = users.find(u => u.email === currentEmail);

  if(!user){
    window.location.href="auth/login.html";
    return;
  }

  document.getElementById("welcomeText").innerText =
    "Welcome, " + user.name;

  const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
  const myBookings = bookings.filter(b => b.userEmail === currentEmail);

  const container = document.getElementById("appointments");
  container.innerHTML = "";

  if(!myBookings.length){
    container.innerHTML = "<p>No appointments yet.</p>";
    return;
  }

  myBookings.forEach(b=>{
    container.innerHTML += `
      <div class="card">
        <strong>ID:</strong> ${b.appointmentID || "-"}<br>
        ${b.category || "-"} - ${b.service || "-"}<br>
        ${b.date || "-"} | ${b.time || "-"}<br>
        <span class="status ${b.status}">${b.status}</span>

        <div class="timeline">
          Timeline: ${(b.timeline || []).join(" ‚Üí ")}
        </div>
      </div>
    `;
  });

  updateNotificationUI();
}

function updateNotificationUI(){

  const currentEmail = sessionStorage.getItem("currentUserEmail");
  const badge = document.getElementById("notifyCount");
  const box = document.getElementById("notifyBox");

  const list = getUserNotifications(currentEmail);

  badge.innerText = getUnreadCount(currentEmail);

  box.innerHTML = "";

  list.slice().reverse().forEach(n=>{
    box.innerHTML += `
      <div class="notification-item">
        ${n.message}<br>
        <small>${n.time}</small>
      </div>
    `;
  });
}

function toggleNotifications(){
  const box = document.getElementById("notifyBox");
  const currentEmail = sessionStorage.getItem("currentUserEmail");

  box.style.display = box.style.display === "block" ? "none" : "block";

  if(box.style.display === "block"){
    markNotificationsRead(currentEmail);
    updateNotificationUI();
  }
}

function logout(){
  sessionStorage.removeItem("currentUserEmail");
  sessionStorage.removeItem("activeSession");
  window.location.href="auth/login.html";
}
</script>

</body>
</html>