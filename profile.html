<!DOCTYPE html>
<html>
<head>
  <title>AppointEase â€” Profile</title>

  <style>
    body{
      margin:0;
      font-family:Arial, sans-serif;
      background:#f3f4f6;
    }

    .container{
      max-width:900px;
      margin:30px auto;
      padding:20px;
    }

    .profile-card{
      display:flex;
      gap:25px;
      background:white;
      padding:25px;
      border-radius:15px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }

    /* Left section */
    .left{
      width:30%;
      text-align:center;
      border-right:1px solid #eee;
      padding-right:20px;
    }

    .avatar{
      width:120px;
      height:120px;
      border-radius:50%;
      background:#e5e7eb;
      margin:0 auto 15px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:50px;
      color:#4f46e5;
    }

    .left h3{
      margin:5px 0;
    }

    .left p{
      color:#6b7280;
      font-size:14px;
    }

    .stats{
      margin-top:15px;
      display:flex;
      justify-content:center;
      gap:15px;
    }

    .stat-box{
      background:#f3f4f6;
      padding:10px;
      border-radius:10px;
      width:90px;
      text-align:center;
    }

    /* Right section */
    .right{
      width:70%;
    }

    h2{
      margin-top:0;
      color:#111827;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:15px;
    }

    label{
      font-weight:bold;
      display:block;
      margin-bottom:5px;
    }

    input, textarea{
      width:100%;
      padding:8px;
      border-radius:8px;
      border:1px solid #ddd;
    }

    textarea{
      height:80px;
    }

    .actions{
      margin-top:20px;
      display:flex;
      gap:10px;
    }

    button{
      padding:10px 14px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
    }

    .save{
      background:#4f46e5;
      color:white;
    }

    .back{
      background:#111827;
      color:white;
    }

    .msg{
      margin-top:10px;
      font-size:14px;
    }
  </style>
</head>

<body>

<div class="container">

  <div class="profile-card">

    <!-- LEFT SIDE -->
    <div class="left">
      <div class="avatar">ðŸ‘¤</div>

      <h3 id="displayName">User Name</h3>
      <p id="displayEmail">user@email.com</p>

      <div class="stats">
        <div class="stat-box">
          <p>Total</p>
          <h4 id="totalStat">0</h4>
        </div>

        <div class="stat-box">
          <p>Pending</p>
          <h4 id="pendingStat">0</h4>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <div class="right">
      <h2>Profile Details</h2>

      <div class="grid">
        <div>
          <label>Full Name</label>
          <input type="text" id="pName">
        </div>

        <div>
          <label>Email</label>
          <input type="email" id="pEmail" disabled>
        </div>

        <div>
          <label>Phone</label>
          <input type="tel" id="pPhone">
        </div>

        <div>
          <label>City</label>
          <input type="text" id="pCity" placeholder="Your city">
        </div>
      </div>

      <div style="margin-top:15px;">
        <label>About Me</label>
        <textarea id="pBio" placeholder="Write something about yourself..."></textarea>
      </div>

      <div class="actions">
        <button class="save" onclick="saveProfile()">Save Changes</button>
        <button class="back" onclick="goBack()">Back to Dashboard</button>
      </div>

      <p class="msg" id="msg"></p>
    </div>

  </div>

</div>

<script>
function initProfile(){

  const currentEmail = localStorage.getItem("currentUserEmail");

  if(!currentEmail){
    window.location.href = "auth/login.html";
    return;
  }

  const users = JSON.parse(localStorage.getItem("users") || "[]");
  const user = users.find(u => u.email === currentEmail);

  if(!user) return;

  // ---- AUTO-FILL FROM SIGNUP ----
  document.getElementById("pName").value = user.name;
  document.getElementById("pEmail").value = user.email;
  document.getElementById("pPhone").value = user.phone || "";

  document.getElementById("displayName").innerText = user.name;
  document.getElementById("displayEmail").innerText = user.email;

  document.getElementById("pCity").value = user.city || "";
  document.getElementById("pBio").value = user.bio || "";

  // ðŸ”¥ Load appointment stats ONLY for this user
  const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");

  const myBookings = bookings.filter(b => b.userEmail === currentEmail);

  document.getElementById("totalStat").innerText = myBookings.length;

  const pending = myBookings.filter(b => b.status === "Pending").length;
  document.getElementById("pendingStat").innerText = pending;
}

function saveProfile(){

  const currentEmail = localStorage.getItem("currentUserEmail");
  const users = JSON.parse(localStorage.getItem("users") || "[]");

  const name = document.getElementById("pName").value.trim();
  const phone = document.getElementById("pPhone").value.trim();
  const city = document.getElementById("pCity").value.trim();
  const bio = document.getElementById("pBio").value.trim();
  const msg = document.getElementById("msg");

  if(!name || !phone){
    msg.style.color="red";
    msg.innerText = "Name and phone cannot be empty.";
    return;
  }

  if(!/^[0-9]{10}$/.test(phone)){
    msg.style.color="red";
    msg.innerText = "Phone must be exactly 10 digits.";
    return;
  }

  // ðŸ”¥ Update correct user inside users array
  const updatedUsers = users.map(u=>{
    if(u.email === currentEmail){
      return {
        ...u,
        name,
        phone,
        city,
        bio
      };
    }
    return u;
  });

  localStorage.setItem("users", JSON.stringify(updatedUsers));

  // Update display instantly
  document.getElementById("displayName").innerText = name;

  msg.style.color="green";
  msg.innerText = "Profile updated successfully!";
}

function goBack(){
  window.location.href = "user-dashboard.html";
}

initProfile();
</script>

</body>
</html>
